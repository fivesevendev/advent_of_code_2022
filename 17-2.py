#AOC-2022-17-2


import timeit
import time
from copy import deepcopy


def numFind(n):
    global tetris
    tetris = {(0,1):"-",(0,2):"-",(0,3):"-",(0,4):"-",(0,5):"-",(0,6):"-",(0,7):"-",}
    shape_order = ['horz', 'plus', 'corner', 'vert', 'square']
    step = 1
    rocks = 0
    maxHeight = 0
    sOrder, sLen = 0, len(shape_order)
    with open("17.txt") as f:
        f = f.read()
    f = list(f)
    print("flen:", len(f))
    jOrder, jLen = 0, len(f)
    while rocks < n:
        piece = shape_order[sOrder]
        sPos = shape_builder(piece, maxHeight)
        dropping = True
        while dropping: #place while loop here eventually
            sPos = shape_push(sPos, f[jOrder]) #pushes the shape one position
            sPos, dropping = shape_drop(sPos) #drops the shape one position
            jOrder = (jOrder + 1) % jLen #selects the next direction to push
        #time.sleep(.5)
        rocks += 1
        sOrder = (sOrder + 1) % sLen #selects the next shape to drop
        for coord in sPos:
            tetris[tuple(coord)] = "#" #adds all rested segments to tetris
        print("{}".format(max(tetris)[0] - maxHeight), end="")
        maxHeight = max(tetris)[0]
        step += 1
    print()
    tetris = {(0,1):"-",(0,2):"-",(0,3):"-",(0,4):"-",(0,5):"-",(0,6):"-",(0,7):"-",} #empties the list back to default for testing
    return maxHeight #gives height of highest piece in tetris

def shape_builder(shape, bottom):
    bottom += 4
    if shape == "horz":
        shape_pos = [[bottom, 3], [bottom, 4], [bottom, 5], [bottom, 6]]
    elif shape == "plus":
        shape_pos = [[bottom, 4], [bottom + 1, 3], [bottom + 1, 4], [bottom + 1, 5], [bottom + 2, 4]]
    elif shape == "corner":
        shape_pos = [[bottom, 3], [bottom, 4], [bottom, 5], [bottom + 1, 5], [bottom + 2, 5]]
    elif shape == "vert":
        shape_pos = [[bottom, 3], [bottom + 1, 3], [bottom + 2, 3], [bottom + 3, 3]]
    elif shape == "square":
        shape_pos = [[bottom, 3], [bottom, 4], [bottom + 1, 3], [bottom + 1, 4]]
    return shape_pos

def shape_drop(drop_pos):
    old_drop = deepcopy(drop_pos)
    for segDrop in range(len(drop_pos)):
        drop_pos[segDrop][0] = drop_pos[segDrop][0] - 1 #drops all row positions by 1
    if rested(drop_pos) == True:
        return (old_drop, False)
    return (drop_pos, True)

def shape_push(push_pos, direction):
    old_push = deepcopy(push_pos)
    if direction == ">":
        direction = 1
    elif direction == "<":
        direction = -1
    for segPush in range(len(push_pos)):
        push_pos[segPush][1] = push_pos[segPush][1] + direction #pushes all column positions by 1
    if collision(push_pos) == True:
        return old_push
    return push_pos

def rested(shape_pos):
    for segRested in shape_pos:
        if tuple(segRested) in tetris:
            return True
    return False

def collision(shape_pos):
    for segCollision in shape_pos:
        if segCollision[1] > 7 or segCollision[1] < 1 or tuple(segCollision) in tetris:
            return True
    return False


#INPUT
#first 632 steps/heights sum to 1006
13220123221212013300130201230013300133200230213220022201213213300133221212213300133001330002302132001230013300023001332013002132021301113300123221330013342133201332013240133001234013012123011121213222133221330013222022121334013030122401230013300132100302212301133221330002220121421334002342133201301112322103221330200300023020120012220133201212013202132401320213322133001322213220022421212212302122221332012320133021031003340133001322213302122201030202322132021330013342133201330012130012421332213240003001330012302003421322212202133020330012202133221230013220023001334013320023201334012302122001122013240003001322013242130101322002
#the next 1705 steps/heights sum to 2649 and repeat
pat_str = "3201330013300122221330012130030021214002200023021334012300021421330013320132201334002300123001230112300023011320213342030001230013340121221330013212132401303013032023221332013002133020034013030132120121211222023021232002342121201230003322132011332213002023021302203320030301332213011132201320012120133201230012300022001320211211132201330213220132100330213240002001304013040133020220013202132201322213300132121330010320133221322002222130300234012222132221302213022121011213003200121221332012300123401334012300132111121003020133221330013040132221332013220123200234000340003000330013040133221330213300130220032003320133001222213320123000222213042132000304013340003001300212130023401303213322133021332010322121200330200312133220032013300122401230001240132200222200311130221230012302132400222213220130110334013322121200222213030132221332013040003000213003002022221034012340003201213013342100021330002300132001212213320121011330013342132201334013220132121330212130121011330013320132001124013322133221232013211103101230012122133220221013022130421230012130032401211012202022201222013300023001330013300133201332013200132020221212322132220332002302133201324013322132001232013300132221031201300123221332202202103221332012301033001222213211133221212213300132021330013300133201332213340133020032013302133021224013300132121334213220130201332211242130301320013300003101334000340133001303012320011201210012301033201330213030022421334213300123200221213300132110330002322112201303212340121201302013322122420332213222132000230200302112101030213222132421332013200121401324203000133400222012211130201232002042001401324213300133021300113320132201334213340130001332013320122221032012301032000332013220130321321013020122101330213"
#10000 rocks
tenK = "13220123221212013300130201230013300133200230213220022201213213300133221212213300133001330002302132001230013300023001332013002132021301113300123221330013342133201332013240133001234013012123011121213222133221330013222022121334013030122401230013300132100302212301133221330002220121421334002342133201301112322103221330200300023020120012220133201212013202132401320213322133001322213220022421212212302122221332012320133021031003340133001322213302122201030202322132021330013342133201330012130012421332213240003001330012302003421322212202133020330012202133221230013220023001334013320023201334012302122001122013240003001322013242130101322002#3201330013300122221330012130030021214002200023021334012300021421330013320132201334002300123001230112300023011320213342030001230013340121221330013212132401303013032023221332013002133020034013030132120121211222023021232002342121201230003322132011332213002023021302203320030301332213011132201320012120133201230012300022001320211211132201330213220132100330213240002001304013040133020220013202132201322213300132121330010320133221322002222130300234012222132221302213022121011213003200121221332012300123401334012300132111121003020133221330013040132221332013220123200234000340003000330013040133221330213300130220032003320133001222213320123000222213042132000304013340003001300212130023401303213322133021332010322121200330200312133220032013300122401230001240132200222200311130221230012302132400222213220130110334013322121200222213030132221332013040003000213003002022221034012340003201213013342100021330002300132001212213320121011330013342132201334013220132121330212130121011330013320132001124013322133221232013211103101230012122133220221013022130421230012130032401211012202022201222013300023001330013300133201332013200132020221212322132220332002302133201324013322132001232013300132221031201300123221332202202103221332012301033001222213211133221212213300132021330013300133201332213340133020032013302133021224013300132121334213220130201332211242130301320013300003101334000340133001303012320011201210012301033201330213030022421334213300123200221213300132110330002322112201303212340121201302013322122420332213222132000230200302112101030213222132421332013200121401324203000133400222012211130201232002042001401324213300133021300113320132201334213340130001332013320122221032012301032000332013220130321321013020122101330213#3201330013300122221330012130030021214002200023021334012300021421330013320132201334002300123001230112300023011320213342030001230013340121221330013212132401303013032023221332013002133020034013030132120121211222023021232002342121201230003322132011332213002023021302203320030301332213011132201320012120133201230012300022001320211211132201330213220132100330213240002001304013040133020220013202132201322213300132121330010320133221322002222130300234012222132221302213022121011213003200121221332012300123401334012300132111121003020133221330013040132221332013220123200234000340003000330013040133221330213300130220032003320133001222213320123000222213042132000304013340003001300212130023401303213322133021332010322121200330200312133220032013300122401230001240132200222200311130221230012302132400222213220130110334013322121200222213030132221332013040003000213003002022221034012340003201213013342100021330002300132001212213320121011330013342132201334013220132121330212130121011330013320132001124013322133221232013211103101230012122133220221013022130421230012130032401211012202022201222013300023001330013300133201332013200132020221212322132220332002302133201324013322132001232013300132221031201300123221332202202103221332012301033001222213211133221212213300132021330013300133201332213340133020032013302133021224013300132121334213220130201332211242130301320013300003101334000340133001303012320011201210012301033201330213030022421334213300123200221213300132110330002322112201303212340121201302013322122420332213222132000230200302112101030213222132421332013200121401324203000133400222012211130201232002042001401324213300133021300113320132201334213340130001332013320122221032012301032000332013220130321321013020122101330213320133001330012222133001213003002121400220002302133401230002142133001332013220133400230012300123011230002301132021334203000123001334012122133001321213240130301303202322133201300213302003401303013212012121122202302123200234212120123000332213201133221300202302130220332003030133221301113220132001212013320123001230002200132021121113220133021322013210033021324000200130401304013302022001320213220132221330013212133001032013322132200222213030023401222213222130221302212101121300320012122133201230012340133401230013211112100302013322133001304013222133201322012320023400034000300033001304013322133021330013022003200332013300122221332012300022221304213200030401334000300130021213002340130321332213302133201032212120033020031213322003201330012240123000124013220022220031113022123001230213240022221322013011033401332212120022221303013222133201304000300021300300202222103401234000320121301334210002133000230013200121221332012101133001334213220133401322013212133021213012101133001332013200112401332213322123201321110310123001212213322022101302213042123001213003240121101220202220122201330002300133001330013320133201320013202022121232213222033200230213320132401332213200123201330013222103120130012322133220220210322133201230103300122221321113322121221330013202133001330013320133221334013302003201330213302122401330013212133421322013020133221124213030132001330000310133400034013300130301232001120121001230103320133021303002242133421330012320022121330013211033000232211220130321234012120130201332212242033221322213200023020030211210103021322213242133201320012140132420300013340022201221113020123200204200140132421330013302130011332013220133421334013000133201332012222103201230103200033201322013032132101302012210133021332013300133001222213300121300300212140022000230213340123000214213300133201322013340023001230012301123000230113202133420300012300133401212213300132121324013030130320232213320130021330200340130301321201212112220230212320023421212012300033221320113322130020230213022033200303013322130111322013200121201332012300123000220013202112111322013302132201321003302132400020013040130401330202200132021322013222133001321213300103201332213220022221303002340122221322213022130221210112130032001212213320123001234013340123001321111210030201332213300130401322213320132201232002340003400030003300130401332213302133001302200320033201330012222133201230002222130421320003040133400030013002121300234013032133221330213320103221212003302003121332200320133001224012300012401322002222003111302212300123021324002222132201301103340133221212002222130301322213320130400030002130030020222210340123400032012130133421000213300023001320012122133201210113300133421322013340132201321213302121301210113300133201320011240133221332212320132111031012300121221332202210130221304212300121300324012110122020222012220133000230013300133001332013320132001320202212123221322203320023021332013240133221320012320133001322210312013001232213322022021032213320123010330012222132111332212122133001320213300133001332013322133401330200320133021330212240133001321213342132201302013322112421303013200133000031013340003401330013030123200112012100123010332013302130300224213342133001232002212133001321103300023221122013032123401212013020133221224203322132221320002302003021121010302132221324213320132001214013242030001334002220122111302012320020420014013242133001330213001133201322013342133401300013320133201222210320123010320003320132201303213210130201221013302133201330013300122221330012130030021214002200023021334012300021421330013320132201334002300123001230112300023011320213342030001230013340121221330013212132401303013032023221332013002133020034013030132120121211222023021232002342121201230003322132011332213002023021302203320030301332213011132201320012120133201230012300022001320211211132201330213220132100330213240002001304013040133020220013202132201322213300132121330010320133221322002222130300234012222132221302213022121011213003200121221332012300123401334012300132111121003020133221330013040132221332013220123200234000340003000330013040133221330213300130220032003320133001222213320123000222213042132000304013340003001300212130023401303213322133021332010322121200330200312133220032013300122401230001240132200222200311130221230012302132400222213220130110334013322121200222213030132221332013040003000213003002022221034012340003201213013342100021330002300132001212213320121011330013342132201334013220132121330212130121011330013320132001124013322133221232013211103101230012122133220221013022130421230012130032401211012202022201222013300023001330013300133201332013200132020221212322132220332002302133201324013322132001232013300132221031201300123221332202202103221332012301033001222213211133221212213300132021330013300133201332213340133020032013302133021224013300132121334213220130201332211242130301320013300003101334000340133001303012320011201210012301033201330213030022421334213300123200221213300132110330002322112201303212340121201302013322122420332213222132000230200302112101030213222132421332013200121401324203000133400222012211130201232002042001401324213300133021300113320132201334213340130001332013320122221032012301032000332013220130321321013020122101330213320133001330012222133001213003002121400220002302133401230002142133001332013220133400230012300123011230002301132021334203000123001334012122133001321213240130301303202322133201300213302003401303013212012121122202302123200234212120123000332213201133221300202302130220332003030133221301113220132001212013320123001230002200132021121113220133021322013210033021324000200130401304013302022001320213220132221330013212133001032013322132200222213030023401222213222130221302212101121300320012122133201230012340133401230013211112100302013322133001304013222133201322012320023400034000300033001304013322133021330013022003200332013300122221332012300022221304213200030401334000300130021213002340130321332213302133201032212120033020031213322003201330012240123000124013220022220031113022123001230213240022221322013011033401332212120022221303013222133201304000300"


def pattern(tk):
    tk_len = len(tk)
    max_len = 0
    max_pattern = ""
    for chunk in range(1, 2000):
        for start in range(0, tk_len - chunk):
            if tk.count(tk[start:start + chunk]) > 2 and len(tk[start:start + chunk]) > max_len:
                max_len = len(tk[start:start + chunk])
                max_pattern = tk[start:start + chunk]
    print("Pattern:", max_pattern)
    return max_len

def estimator(target):
    iSteps, iSum = 632, 1006
    pSteps, pSum = 1705, 2649
    uFlow = ((target - iSteps) % pSteps)
    extra = sum(list(map(int, list(pat_str[:uFlow]))))
    output = (((target - iSteps) // pSteps) * pSum) + iSum
    return output + extra


if __name__ == '__main__':
    startTime = timeit.default_timer()
    print(">>>>>", time.asctime(), "<<<<<\n")
    n = 1_000_000_000_000
    #print(pattern(tenK))
    print("Result:", estimator(n))
    print("Run Time Was {:.4F} Seconds".format(timeit.default_timer() - startTime))
    print("\n>>>>>", time.asctime(), "<<<<<")